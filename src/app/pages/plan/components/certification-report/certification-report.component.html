<span class="open" (click)="openMenu()">
  <img src="assets/img/menu.png" />
</span>

<div *ngIf="menuIsOpen" class="report-menu">
  <span class="close" (click)="closeMenu()">&#10005;</span>
  <div *ngFor="let section of menuItems; index as menuItemIdx">
    <div class="menu-section">
      <h4 (click)="scrollToTable(camelize(section.title), false)">{{section.title}}</h4>
      <div *ngFor="let tableName of section.tableNames; index as tableNameIdx">
        <h6 (click)="scrollToTable(camelize(section.title), (menuItemIdx === menuItems.length - 1 && tableNameIdx === section.tableNames.length - 1), camelize(tableName))">{{tableName}}</h6>
      </div>
    </div>
  </div>
</div>

<div class="filter-score-container">
  <div class="header">
    <h4>L2 Certification Report</h4>
  </div>
  
  <div class="report-score-container">
    <div>
      <h4>Total Count</h4>
      <span>{{initialReports?.totalscore}}</span>
    </div>
    <span class="score-indicator">{{initialReports?.totalPassFail}}</span>
    <img src='assets/img/{{flagImgSrc}}' (click)="toggleFlagFilter()" />
  </div>

</div>


<div>
  <div class="certification-report">
    <div class="v-scrollbar" *ngFor="let report of reports; index as i">
      <h4 *ngIf="report.fileName" id="item-{{camelize(report.fileName)}}" [ngClass]="i === 0 ? 'first-filename' : ''">{{report.fileName}}</h4>
     
      <div *ngIf="report.metricTable?.length!==0">
        <table *ngIf="report.metricTable" id="item-{{camelize(report.fileName)}}-metricTable">
          <colgroup span="8"></colgroup>
          <thead>
            <tr>
              <th class="no-width"></th>
              <th>Metric Order Number</th>
              <th>Metric Description</th>
              <th>Computed Value</th>
              <th>Pass Indicator</th>
              <th>Rule Weight Percent</th>
              <th>Score</th>
              <th>Error Msg</th>
            </tr>
          </thead>
          <tbody *ngIf="expandedTables[i]?.metricTable">
            <tr *ngFor="let row of report.metricTable">
              <td [ngClass]="!row.flag ? 'more-padding' : ''">
                <img *ngIf="row.flag" src="assets/img/flag-yellow.png" />
              </td>
              <td>{{row.metricOrderNumber}}</td>
              <td>{{row.metricDescription}}</td>
              <td>{{row.computedValue}}</td>
              <td>{{row.passIndicator}}</td>
              <td>{{row.ruleWeightPercent}}</td>
              <td>{{row.score}}</td>
              <td>{{row.errorMessage}}</td>
            </tr>
            <tr class="bottom-row">
              <td></td>
            </tr>
          </tbody>
          <tbody *ngIf="!expandedTables[i]?.metricTable">
            <ng-container  *ngFor="let row of report.metricTable">
              <tr  *ngIf="row.flag">
                <td >
                  <img src="assets/img/flag-yellow.png" />
                </td>
                <td >{{row.metricOrderNumber}}</td>
                <td >{{row.metricDescription}}</td>
                <td >{{row.computedValue}}</td>
                <td >{{row.passIndicator}}</td>
                <td >{{row.ruleWeightPercent}}</td>
                <td >{{row.score}}</td>
                <td >{{row.errorMessage}}</td>
              </tr>
            </ng-container>
            <tr class="bottom-row">
              <td></td>
            </tr>
          </tbody>
        </table>
  
        <div *ngIf="report?.metricTable?.length">
          <div *ngIf="expandedTables[i]?.metricTable" class="show-less-button-container">
            <button (click)="showLess(i, 'metricTable')">Show Less &minus;</button>
          </div>
          <div *ngIf="!expandedTables[i]?.metricTable" class="show-less-button-container">
            <button (click)="showMore(i, 'metricTable')">Show More &plus;</button>
          </div>
        </div>
      </div>
  
      <div *ngIf="report.financialSummary?.length!==0">
        <table *ngIf="report.financialSummary" id="item-{{camelize(report.fileName)}}-financialSummary">
          <colgroup span="10"></colgroup>
          <thead>
            <tr>
              <th class="no-width"></th>
              <th>Column Name</th>
              <th>Financial Order Number</th>
              <th>Total Valid Amount</th>
              <th>Total Rejected Amount</th>
              <th>Total Amount</th>
              <th>Total Amount Excluding Denied Secondary</th>
              <th>Total Amount Outpatient Facility Only</th>
              <th>Estimated Average Per Valid Script</th>
              <th>Error Msg</th>
            </tr>
          </thead>
          <tbody *ngIf="expandedTables[i]?.financialSummary">
            <tr *ngFor="let row of report.financialSummary">
              <td [ngClass]="!row.flag ? 'more-padding' : ''">
                <img *ngIf="row.flag" src="assets/img/flag-yellow.png" />
              </td>
              <td>{{row.columnName}}</td>
              <td>{{row.financialOrderNumber}}</td>
              <td>{{row.totalValidAmount}}</td>
              <td>{{row.totalAmount}}</td>
              <td>{{row.percentRejected}}</td>
              <td>{{row.totalAmountExcludingDeniedSecondary}}</td>
              <td>{{row.totalAmountOutpatientFacilityOnly}}</td>
              <td>{{row.estimatedAveragePerValidScript}}</td>
              <td>{{row.errorMessage}}</td>
            </tr>
            <tr class="bottom-row">
              <td></td>
            </tr>
          </tbody>
          <tbody *ngIf="!expandedTables[i]?.financialSummary">
            <ng-container *ngFor="let row of report.financialSummary">
              <tr  *ngIf="row.flag">
                <td >
                  <img src="assets/img/flag-yellow.png" />
                </td>
                <td >{{row.columnName}}</td>
                <td >{{row.financialOrderNumber}}</td>
                <td >{{row.totalValidAmount}}</td>
                <td >{{row.totalAmount}}</td>
                <td >{{row.percentRejected}}</td>
                <td >{{row.totalAmountExcludingDeniedSecondary}}</td>
                <td >{{row.totalAmountOutpatientFacilityOnly}}</td>
                <td >{{row.estimatedAveragePerValidScript}}</td>
                <td >{{row.errorMessage}}</td>
              </tr>
            </ng-container>
            <tr class="bottom-row">
              <td></td>
            </tr>
          </tbody>
        </table>
  
        <div *ngIf="report.financialSummary">
          <div *ngIf="expandedTables[i]?.financialSummary" class="show-less-button-container">
            <button (click)="showLess(i, 'financialSummary')">Show Less &minus;</button>
          </div>
          <div *ngIf="!expandedTables[i]?.financialSummary" class="show-less-button-container">
            <button (click)="showMore(i, 'financialSummary')">Show More &plus;</button>
          </div>
        </div>
      </div>
  
      <div *ngIf="report.rxTable?.length!==0">
        <table *ngIf="report.rxTable" id="item-{{camelize(report.fileName)}}-rxTable">
          <colgroup span="4"></colgroup>
          <thead>
            <tr>
              <th>Valid Records</th>
              <th>Voided Records</th>
              <th>Rejected Records</th>
              <th>Total Records</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of report.rxTable">
              <td>{{row.validRecords}}</td>
              <td>{{row.voidedRecords}}</td>
              <td>{{row.rejectedRecords}}</td>
              <td>{{row.totalRecords}}</td>
            </tr>
            <tr class="bottom-row">
              <td></td>
            </tr>
          </tbody>
        </table>
      </div>
  
      <div *ngIf="report.frequencyCountTable?.length!==0">
        <table *ngIf="report.frequencyCountTable" id="item-{{camelize(report.fileName)}}-frequencyCountTable">
          <colgroup span="2"></colgroup>
          <thead>
            <tr>
              <th>Field Value</th>
              <th>Frequency Count</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of report.frequencyCountTable">
              <td>{{row.fieldValue}}</td>
              <td>{{row.frequencyCount}}</td>
            </tr>
            <tr class="bottom-row">
              <td></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
